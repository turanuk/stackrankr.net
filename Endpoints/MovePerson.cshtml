@{
  WebSecurity.RequireAuthenticatedUser();
  Response.AddHeader("Cache-Control", "no-cache");
  if (!IsPost) {
    Response.SetStatus(401);
  } else {
    var personId = Request["PersonId"].AsInt();
    var rankingId = Request["RankingId"].AsInt();
    var index = Request["Index"].AsInt();
    var db = Database.Open("stackRankR");

    //Pull the ranking
    var ranking = db.QuerySingle("SELECT * FROM Ranking WHERE Id = @0", rankingId);
    var team = db.QuerySingle("SELECT * FROM Team WHERE Id = @0", ranking.TeamId);

    //Check for ownership
    //TODO: Support multiple users of a single board
    if (team.OwnerId == WebSecurity.CurrentUserId) {
      db.Execute("UPDATE Person SET RankingId=@0  WHERE Id=@1", rankingId, personId);
      //Now need to update the order within the rankings to preserve the correct order on re-rendering

      Response.SetStatus(200);
    } else {
      Response.SetStatus(401);
    }
  }
}